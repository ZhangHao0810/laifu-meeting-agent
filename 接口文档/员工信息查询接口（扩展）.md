# 员工信息查询接口（扩展）

本文档定义了 new-contacts MCP Server 的扩展查询接口，用于更灵活地查询员工信息。

---

## 接口列表

### 1. getUserByName - 根据姓名查询员工信息
根据员工姓名查询员工的基本信息（主要用于获取工号、BASE地等）。

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| name | string | 是 | 员工姓名（精确匹配） |

#### 请求示例

```json
{
  "name": "王星"
}
```

#### 返回参数

| 参数名 | 类型 | 说明 |
|--------|------|------|
| content | array | 员工信息列表（可能有重名） |
| content[].CODE | string | 员工工号 |
| content[].NAME | string | 员工姓名 |
| content[].ORG_PATH_NAME | string | 所属部门完整路径 |
| content[].BASE_NAME | string | BASE 地 |
| content[].PHONE | string | 联系电话 |
| content[].EMAIL | string | 邮箱地址 |
| message | string | 返回消息 |
| records | integer | 返回记录数 |
| successFlag | boolean | 是否成功 |

#### 返回示例

```json
{
  "content": [
    {
      "CODE": "11528",
      "NAME": "王星",
      "PINYIN": "wang星",
      "SEX_NAME": "男",
      "EMAIL": "wang星@zhongfu.net",
      "PHONE": "18942667857",
      "ORG_PATH_NAME": "公司\\某科技有限公司\\业务中台\\AI产品研发中心",
      "BASE_NAME": "深圳市",
      "IM_OPEN_ID": "c9f2a2c0ca2883f4ada5f11c"
    }
  ],
  "message": "Api access succeeded",
  "records": 1,
  "successFlag": true
}
```

#### 特殊情况

**未找到员工**:
```json
{
  "content": [],
  "message": "Employee not found",
  "records": 0,
  "successFlag": true
}
```

**存在重名**:
```json
{
  "content": [
    {
      "CODE": "10001",
      "NAME": "张伟",
      "ORG_PATH_NAME": "公司\\某科技有限公司\\业务前台",
      "BASE_NAME": "北京市"
    },
    {
      "CODE": "10523",
      "NAME": "张伟",
      "ORG_PATH_NAME": "公司\\某科技有限公司\\业务中台\\AI产品研发中心",
      "BASE_NAME": "上海市"
    }
  ],
  "message": "Multiple employees found with the same name",
  "records": 2,
  "successFlag": true
}
```

---

### 2. getBatchUserInfo - 批量查询员工信息

根据一批员工工号批量查询员工详细信息。

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| codes | array | 是 | 员工工号列表 |
| fields | array | 否 | 需要返回的字段列表，不传则返回全部字段 |

#### 请求示例

**查询全部字段**:
```json
{
  "codes": ["11528", "11529", "11530"]
}
```

**只查询指定字段**:
```json
{
  "codes": ["11528", "11529", "11530"],
  "fields": ["CODE", "NAME", "BASE_NAME", "PHONE", "ORG_PATH_NAME"]
}
```

#### 返回参数

| 参数名 | 类型 | 说明 |
|--------|------|------|
| content | array | 员工信息列表 |
| content[].CODE | string | 员工工号 |
| content[].NAME | string | 员工姓名 |
| content[].BASE_NAME | string | BASE 地 |
| content[].PHONE | string | 联系电话 |
| content[].ORG_PATH_NAME | string | 所属部门 |
| content[].* | any | 其他字段（根据 fields 参数决定） |
| notFound | array | 未找到的工号列表 |
| message | string | 返回消息 |
| records | integer | 成功查询的记录数 |
| successFlag | boolean | 是否成功 |

#### 返回示例

**全部查询成功**:
```json
{
  "content": [
    {
      "CODE": "11528",
      "NAME": "王星",
      "BASE_NAME": "深圳市",
      "PHONE": "18942667857",
      "ORG_PATH_NAME": "公司\\某科技有限公司\\业务中台\\AI产品研发中心"
    },
    {
      "CODE": "11529",
      "NAME": "郑纯桂英",
      "BASE_NAME": "厦门市",
      "PHONE": "18040154942",
      "ORG_PATH_NAME": "公司\\某科技有限公司\\业务中台\\AI产品研发中心"
    },
    {
      "CODE": "11530",
      "NAME": "郭露亮",
      "BASE_NAME": "青岛市",
      "PHONE": "18295512578",
      "ORG_PATH_NAME": "公司\\某科技有限公司\\业务中台\\AI产品研发中心"
    }
  ],
  "notFound": [],
  "message": "Api access succeeded",
  "records": 3,
  "successFlag": true
}
```

**部分工号不存在**:
```json
{
  "content": [
    {
      "CODE": "11528",
      "NAME": "王星",
      "BASE_NAME": "深圳市",
      "PHONE": "18942667857",
      "ORG_PATH_NAME": "公司\\某科技有限公司\\业务中台\\AI产品研发中心"
    }
  ],
  "notFound": ["99999", "88888"],
  "message": "Partial success: 1 found, 2 not found",
  "records": 1,
  "successFlag": true
}
```

---

### 3. searchUsersByName - 模糊搜索员工（可选扩展）

根据姓名关键词模糊搜索员工。

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| keyword | string | 是 | 搜索关键词（支持姓名、拼音） |
| limit | integer | 否 | 返回结果数量限制，默认 10，最大 50 |

#### 请求示例

```json
{
  "keyword": "王",
  "limit": 5
}
```

#### 返回参数

| 参数名 | 类型 | 说明 |
|--------|------|------|
| content | array | 匹配的员工列表 |
| content[].CODE | string | 员工工号 |
| content[].NAME | string | 员工姓名 |
| content[].PINYIN | string | 姓名拼音 |
| content[].ORG_PATH_NAME | string | 所属部门 |
| content[].BASE_NAME | string | BASE 地 |
| message | string | 返回消息 |
| records | integer | 返回记录数 |
| totalMatches | integer | 总匹配数（可能大于返回数） |
| successFlag | boolean | 是否成功 |

#### 返回示例

```json
{
  "content": [
    {
      "CODE": "11528",
      "NAME": "王星",
      "PINYIN": "wang星",
      "ORG_PATH_NAME": "公司\\某科技有限公司\\业务中台\\AI产品研发中心",
      "BASE_NAME": "深圳市"
    },
    {
      "CODE": "10129",
      "NAME": "王鑫雪",
      "PINYIN": "wang鑫xue",
      "ORG_PATH_NAME": "公司\\某科技有限公司\\业务前台",
      "BASE_NAME": "北京市"
    }
  ],
  "message": "Search completed",
  "records": 2,
  "totalMatches": 15,
  "successFlag": true
}
```

---

## 使用场景示例

### 场景 1: 根据姓名列表查询 BASE 地

**步骤**:
1. 使用 `getUserByName` 获取每个人的工号
2. 使用 `getBatchUserInfo` 批量查询详细信息

**示例**:

```javascript
// 第一步：根据姓名获取工号
const names = ['王星', '郑纯桂英', '郭露亮'];
const codes = [];

for (const name of names) {
  const result = await getUserByName({ name });
  if (result.records > 0) {
    codes.push(result.content[0].CODE);
  }
}

// 第二步：批量查询详细信息
const userInfo = await getBatchUserInfo({
  codes: codes,
  fields: ['CODE', 'NAME', 'BASE_NAME', 'PHONE']
});

console.log(userInfo.content);
```

### 场景 2: 查询部门所有成员的 BASE 地分布

**步骤**:
1. 使用 `getDepartmentInfo` 获取部门成员工号列表
2. 使用 `getBatchUserInfo` 批量查询成员信息
3. 统计 BASE 地分布

**示例**:

```javascript
// 第一步：获取部门信息
const dept = await getDepartmentInfo({ orgName: 'AI产品研发中心' });
const codes = dept.content[0].MEMBER_CODES;

// 第二步：批量查询成员信息
const members = await getBatchUserInfo({
  codes: codes,
  fields: ['CODE', 'NAME', 'BASE_NAME']
});

// 第三步：统计 BASE 地分布
const baseDistribution = {};
members.content.forEach(member => {
  const base = member.BASE_NAME;
  baseDistribution[base] = (baseDistribution[base] || 0) + 1;
});

console.log(baseDistribution);
// 输出: { '深圳市': 45, '北京市': 32, '上海市': 28, ... }
```

---

## 错误码说明

| 错误码 | 说明 |
|--------|------|
| 400 | 请求参数错误（缺少必填参数或参数格式错误） |
| 404 | 未找到匹配的员工 |
| 500 | 服务器内部错误 |

---

## 性能说明

- **getUserByName**: 单次查询，响应时间 < 50ms
- **getBatchUserInfo**: 
  - 建议单次查询不超过 100 个工号
  - 每增加 10 个工号，响应时间增加约 5-10ms
  - 100 个工号的批量查询响应时间约 100-150ms

---

## 与现有接口的对比

| 接口 | 查询方式 | 返回数据量 | 适用场景 |
|------|----------|-----------|----------|
| `getCloudUserInfo` | 单个工号 | 单个员工全部字段 | 已知工号，查询详细信息 |
| `getUserByName` | 单个姓名 | 单个/多个员工基本信息 | 已知姓名，获取工号 |
| `getBatchUserInfo` | 多个工号 | 多个员工指定字段 | 批量查询，提高效率 |
| `searchUsersByName` | 关键词模糊搜索 | 多个员工基本信息 | 不确定完整姓名时搜索 |

---

## 建议实现优先级

1. **高优先级**: `getBatchUserInfo` - 批量查询是最实用的功能
2. **中优先级**: `getUserByName` - 姓名到工号的映射很常用
3. **低优先级**: `searchUsersByName` - 模糊搜索是锦上添花的功能

---

## 备注

- 所有接口返回格式与现有的 `getCloudUserInfo` 保持一致
- 支持通过 `fields` 参数控制返回字段，减少数据传输量
- 批量查询接口会返回 `notFound` 列表，方便调用方处理未找到的工号
